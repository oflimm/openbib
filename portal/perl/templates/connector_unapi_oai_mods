<?xml version="1.0" encoding="utf-8"?>
<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:mods="http://www.loc.gov/mods/v3">
    <record>
        <mods xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.loc.gov/mods/v3" version="3.4"
            xsi:schemaLocation="http://www.loc.gov/mods/v3 http://www.loc.gov/standards/mods/v3/mods-3-4.xsd">
            <mods:recordInfo>
                <mods:recordIdentifier>[% record.id %]</mods:recordIdentifier>
            </mods:recordInfo>
            [%- normdata = record.get_fields -%]
            [%- holding = record.get_holding -%]
            [%- circulation = record.load_circulation.get_circulation -%]
            [%- same_records = record.enrich_same_records.get_same_records -%]
            [%- similar_records = record.enrich_similar_records.get_similar_records -%]
            [%-
            personlist = [];
            IF normdata.${"T0100"};
            personlist.push(normdata.${"T0100"});
            END;
            IF normdata.${"T0101"};
            personlist.push(normdata.${"T0101"});
            END;
            IF normdata.${"T0102"};
            personlist.push(normdata.${"T0102"});
            END;
            IF normdata.${"T0103"};
            personlist.push(normdata.${"T0103"});
            END;
            -%]
            [%- IF personlist && personlist.size -%]
            [%- FOREACH persondata IN personlist %]
            [%- FOREACH item IN persondata %]
            <mods:name type="personal">
                [%-
                IF item.content.search(',');
                name_array = item.content.split(','),
                family = name_array.0.trim;
                given = name_array.1.trim;
                ELSE;
                given = item.content.trim;
                END;
                -%]
                [%- IF family %]
                <mods:namePart type="family">[% family %]</mods:namePart>
                [%- END %]
                <mods:namePart type="given">[% given %]</mods:namePart>
                <mods:displayForm>[% item.content %]</mods:displayForm>
                <mods:role>
                    [%- IF item.supplement %]
                    <mods:roleTerm type="code" authority="marcrelator" text="[%item.supplement%]">oth</mods:roleTerm>
                    [%- ELSE %]
                    <mods:roleTerm type="code" authority="marcrelator">aut</mods:roleTerm>
                    [%- END %]
                </mods:role>
            </mods:name>
            [%- END -%]
            [%- END -%]
            [%- END -%]
            [%-
            corplist = [];
            IF normdata.${"T0200"};
            corplist.push(normdata.${"T0100"});
            END;
            IF normdata.${"T0201"};
            corplist.push(normdata.${"T0101"});
            END;
            %]
            [%- IF corplist && corplist.size %]
            [%- FOREACH corpdata IN corplist %]
            [%- FOREACH item IN corpdata %]
            <mods:name type="corporate">
                <mods:namePart>[% item.content %]</mods:namePart>
                <mods:role>
                    [%- IF item.supplement %]
                    <mods:roleTerm type="code" authority="marcrelator" text="[% item.supplement %]">oth</roleTerm>
                        [%- ELSE %]
                        <mods:roleTerm type="code" authority="marcrelator">aut</mods:roleTerm>
                        [%- END %]
                </mods:role>
            </mods:name>
            [%- END -%]
            [%- END -%]
            [%- END -%]
            [%- IF normdata.${"T0331"} %]
            <mods:titleInfo>
                <mods:title>[% normdata.${"T0331"}.first.content %]</mods:title>
                [%- FOREACH item IN normdata.${"T0335"} %]
                <mods:subtitle>[% item.content %]</mods:subtitle>
                [%- END %]
            </mods:titleInfo>
            [%- END %]
            [%- IF normdata.${"T0370"} -%]
            [%- FOREACH alt_title IN normdata.${"T0370"} %]
            <mods:titleInfo type="alternative">
                <mods:title>[% alt_title.content %]</mods:title>
            </mods:titleInfo>
            [%- END %]
            [%- END %]
            [%- IF normdata.${"T0341"} -%]
            [%- FOREACH title_trans IN normdata.${"T0341"} -%]
            <mods:titleInfo type="translated">
                <mods:title>[% title_trans.content %]</mods:title>
            </mods:titleInfo>
            [%- END %]
            [%- END %]
            [%-
            uniform_titlelist = [];
            IF normdata.${"T0304"};
            uniform_titlelist.push(normdata.${"T0304"});
            END;
            IF normdata.${"T0306"};
            uniform_titlelist.push(normdata.${"T0306"});
            END;
            IF normdata.${"T0310"};
            uniform_titlelist.push(normdata.${"T0310"});
            END;
            IF normdata.${"T7304"};
            uniform_titlelist.push(normdata.${"T7304"});
            END; %]
            [%- IF uniform_titlelist && uniform_titlelist.size %]
            [%-FOREACH uniform_title_data IN uniform_titlelist %]
            [%- FOREACH uniform_title IN uniform_title_data %]
            <mods:titleInfo type="uniform">
                <mods:title>[% uniform_title.content %]</mods:title>
            </mods:titleInfo>
            [%- END %]
            [%- END %]
            [%- END %]
            [%-
            IF normdata.${"T5005"}.first;
            super = from_json(normdata.${"T5005"}.first.content);
            super_title = super.fields.${'0451'}.first.content;
            IF super.fields.${'0331'} ;
            super_title = super.fields.${'0331'}.first.content;
            END ;
            END; %]
            <mods:originInfo eventType="publication">
                [%- FOREACH item IN normdata.${"T0410"} %]
                <mods:place>
                    <mods:placeTerm type="text">[% item.content %]</mods:placeTerm>
                </mods:place>
                [%- END %]
                [%- type_is_set = "false" %]
                [%- FOREACH item IN normdata.${"T4410"} %]
                [%- IF item.content == "Monografie" && type_is_set == "false" %]
                <mods:issuance>monographic</mods:issuance>
                [%- type_is_set = "true" %]
                [% ELSIF item.content.content == "Zeitschrift/Serie" && type_is_set == 'false' %]
                <mods:issuance>serial</mods:issuance>
                [%- type_is_set = "true" %]
                [%- END %]
                [%- END %]
                [%- IF type_is_set =="false" %]
                [%- IF normdata.${"T0572"} || normdata.${"T0543"} || normdata.${"T5002"}%]
                <mods:issuance>serial</mods:issuance>
                [%- ELSE -%]
                <mods:issuance>monographic</mods:issuance>
                [%- END %]
                [%- END %]
                [%- FOREACH item IN normdata.${"T0412"} %]
                <mods:publisher>[% item.content %]</mods:publisher>
                [%- END %]
                [%- FOREACH item IN normdata.${"T0425"} %]
                <mods:dateIssued keyDate="yes" encoding="iso8601">[% item.content %]</mods:dateIssued>
                [%- END %]
            </mods:originInfo>
            [%- IF normdata.${"T4301"}.first %]
            <mods:language>
                <mods:languageTerm type="code" authority="iso639-2">[% normdata.${"T4301"}.first.content %]
                </mods:languageTerm>
            </mods:language>
            [%-END%]
            [%- IF normdata.${"T4310"}.first %]
            <mods:note type="ownership">
                [% normdata.${"T4310"}.first.content %]
            </mods:note>
            [%- END %]
            [%- FOREACH item IN normdata.${"T4700"} %]
            <mods:classification authority="ZVDD">[% item.content %]</mods:classification>
            [%- END %]
            [%- IF normdata.${"T0710"}.first %]
            <mods:subject>
                [%- FOREACH item IN normdata.${"T0710"} %]
                <mods:topic>[% item.content %]</mods:topic>
                [%- END %]
            </mods:subject>
            [%- END %]
            [%- IF super %]
            <mods:relatedItem type="host">
                <mods:recordInfo>
                    <mods:recordIdentifier>[% normdata.${"T0004"}.first.content %]</mods:recordIdentifier>
                </mods:recordInfo>
                <mods:titleInfo>
                    <mods:title>[% super_title %]</mods:title>
                </mods:titleInfo>
            </mods:relatedItem>
            <mods:part>
                <mods:detail type="volume">
                    [%- IF NOT normdata.${"T0331"} %]
                    <mods:number>[% normdata.${"T0089"}.first.content %]</mods:number>
                    [%- ELSIF normdata.${"T0455"} %]
                    <mods:number>[% normdata.${"T0455"}.first.content %]</mods:number>
                    [%- END %]
                </mods:detail>
            </mods:part>
            [%- END %]
            [%- IF NOT super && normdata.${"T0451"} -%]
            <mods:relatedItem type="series">
                <mods:titleInfo>
                    <mods:title>[% normdata.${"T0451"}.first.content %]</mods:title>
                </mods:titleInfo>
                [%- IF normdata.${"T0455"} %]
                <mods:part>
                    <mods:detail type="volume">
                        <mods:number>[% normdata.${"T0455"}.first.content %]</mods:number>
                    </mods:detail>
                </mods:part>
                [%- END %]
            </mods:relatedItem>
            [%END%]
        </mods>
    </record>
</OAI-PMH>